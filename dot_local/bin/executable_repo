#!/bin/bash
set -eu

# ウィンドウ名を正規化（ブランチ名から特殊文字を置換）
normalize_window_name() {
  echo "$1" | tr '/./' '_'
}

selected=$(ghq list | fzf)
[[ -z "$selected" ]] && exit 0

dir="$(ghq root)/$selected"
session_name=$(basename "$selected" | tr '.' '_')
window_name=$(normalize_window_name "$(git -C "$dir" branch --show-current 2>/dev/null || echo "main")")

if tmux has-session -t "$session_name" 2>/dev/null; then
  tmux attach-session -t "$session_name"
else
  tmux new-session -d -s "$session_name" -n "$window_name" -c "$dir"
  tmux attach-session -t "$session_name"
fi
